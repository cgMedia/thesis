\usetikzlibrary{colorbrewer, decorations.pathreplacing, shapes, calc}

\begin{tikzpicture}[>=latex, scale=2]

% Draw major grid
\draw[step=1, black, thick, opacity=0.1] (-2,-2) grid (3, 3);

% Draw colored ``zones''
\fill[cbblue, opacity=0.4] (0,0) rectangle (1, 1);
\fill[cbblue, opacity=0.2] (-1,-1) rectangle (2, 2);

% Draw expansion points
\foreach \x in {-1,...,2} {
  \foreach \y in {-1,...,2} {
    \draw[thick, cbblue, fill=white, radius=0.1] (\x,\y) circle;
  }
}

% Draw and label interior grid
\foreach \x in {0.25, 0.5, 0.75} {
  \foreach \y in {0.25, 0.5, 0.75} {
    \draw[cbblue, fill=white, radius=0.05] (\x, \y) circle;

    \draw[cbblue!50] ($(\x,\y) - ({1/(20 * sqrt(2))}, {1/(20 * sqrt(2))})$) -- ($(\x,\y) + ({1/(20 * sqrt(2))}, {1/(20 * sqrt(2))})$);
    \draw[cbblue!50] ($(\x,\y) - ({1/(20 * sqrt(2))}, {-1/(20 * sqrt(2))})$) -- ($(\x,\y) + ({1/(20 * sqrt(2))}, {-1/(20 * sqrt(2))})$);
  }
}

\node[radius=0.03] (g1) at (0.25, 0.25) {};
\node[radius=0.03] (g2) at (0.50, 0.25) {};
\node[radius=0.03] (g3) at (0.75, 0.25) {};

\node[cbblue] (grid) at (0.5, -0.25) {Interior grid};

\draw[cbblue, ->] (grid) -- (g1);
\draw[cbblue, ->] (grid) -- (g2);
\draw[cbblue, ->] (grid) -- (g3);

% Draw and label particles
\fill[cbblue, radius=0.03] (0.1, 0.75) node (A) {} circle;
\fill[cbblue, radius=0.03] (0.325, 0.4) node (B) {} circle;
\fill[cbblue, radius=0.03] (0.7, 0.65) node (C) {} circle;

\fill[cbblue, radius=0.06] (0, 0) circle;
\node[cbblue] at (-0.3, 0) {$\mathbf{r}_\text{box}$};

\node[cbblue] (pts) at (0.5, 1.2) {Particles};
\draw[cbblue, ->] (pts) -- (A);
\draw[cbblue, ->] (pts) -- (B);
\draw[cbblue, ->] (pts) -- (C);

% Add annotations
\draw[cbblue, thick, decorate,decoration={brace,amplitude=10}] (-1.1,2.2) -- (2.1, 2.2) node [midway, above, yshift=10] {Expansion region};
\draw[cbblue, thick, decorate,decoration={brace,amplitude=10}] (1.1,1.1) -- (1.1, -0.1) node [midway, right, xshift=10] {Box};

\draw[<->, cbblue] (-2, -1.8) -- (-1, -1.8) node [midway, fill=white] {$s_x$};
\draw[<->, cbblue] (-1.8, -2) -- (-1.8, -1) node [midway, fill=white] {$s_y$};

\end{tikzpicture}
